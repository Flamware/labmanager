<!DOCTYPE html >
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<th:block th:replace="fragments/head :: style" />
<th:block th:replace="fragments/head :: sharedScript" />

<th:block th:if="${changeEnabled}">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.2.0/dist/sweetalert2.all.min.js"></script>
	<th:block th:replace="fragments/head :: sharedScriptDeletionButton"></th:block>
</th:block>

<table class="table table-responsive-sm table-bordered table-striped table-sm" th:id="${'table'+uuid}" style="width: 100%">
    <thead>
        <th th:text="#{html.Id}"></th>
        <th th:utext="#{html.LastName}"></th>
        <th th:utext="#{html.FirstName}"></th>
        <th th:utext="#{html.Gravatar}"></th>
        <th th:utext="#{html.ORCID}"></th>
        <th th:utext="#{html.Hindex}"></th>
        <th th:utext="#{html.CurrentOrganizations}"></th>
        <th th:utext="#{html.FormerOrganizations}"></th>
        <th th:utext="#{html.FutureOrganizations}"></th>
        <th th:text="#{html.Actions}"></th>
    </thead>
    <tbody>
        <tr th:each="person : ${persons}">
            <td>
                <th:block th:utext="${person.id}"></th:block>
            </td>
            <td th:with="actives = ${person.activeMemberships}">
                <s th:if="${actives.isEmpty() && !person.memberships.isEmpty()}"
                   th:utext="${person.lastName}"></s>
                <i th:if="${actives.isEmpty() && person.memberships.isEmpty()}"
                          th:utext="${person.lastName}"></i>
                <th:block th:if="${!actives.isEmpty()}"
                          th:utext="${person.lastName}"></th:block>
            </td>
            <td th:with="actives = ${person.activeMemberships}">
                <s th:if="${actives.isEmpty() && !person.memberships.isEmpty()}"
                     th:utext="${person.firstName}"></s>
                <i th:if="${actives.isEmpty() && person.memberships.isEmpty()}"
                          th:utext="${person.firstName}"></i>
                <th:block th:if="${!actives.isEmpty()}"
                          th:utext="${person.firstName}"></th:block>
            </td>
            <td>
                <img th:if="${person.gravatarId != null}"
                     th:src="${person.getGravatarURL()}"
                     th:title="${person.gravatarId}"></img>
            </td>
            <td>
                <a th:if="${person.ORCID != null}"
                   th:href="${person.orcidURL}"
                   th:utext="${person.ORCID}"></a>
            </td>
            <td>
                <th:block th:if="${person.googleScholarHindex > 0}"
                          th:utext="#{html.GoogleScholarHindex(${person.googleScholarHindex})}"></th:block>
                <th:block th:if="${person.googleScholarHindex > 0 && person.wosHindex > 0}"
                          th:utext="', '"></th:block>
                <th:block th:if="${person.wosHindex > 0}"
                          th:utext="#{html.WosHindex(${person.wosHindex})}"></th:block>
            </td>
            <td>
                <th:block th:each="mbr, iMbr : ${person.activeMemberships}">
                    <th:block th:if="${!iMbr.first}">, </th:block>
                    <th:block th:if="${mbr.value.memberStatus == null}"
                              th:utext="${'ERROR:' + mbr.key.acronymOrName}"></th:block>
                    <a th:if="${mbr.value.memberStatus != null}"
                       th:href="@{/memberList(organization=${mbr.key.acronymOrName})}"
                       th:title="${mbr.value.memberStatus.getLabel(locale)}"
                       th:utext="${mbr.key.acronymOrName}"></a>
                </th:block>
            </td>
            <td>
                <th:block th:each="mbr, iMbr : ${person.finishedMemberships}">
                    <th:block th:if="${!iMbr.first}">, </th:block>
                    <th:block th:if="${mbr.value.memberStatus == null}"
                              th:utext="${'ERROR:' + mbr.key.acronymOrName}"></th:block>
                    <a th:if="${mbr.value.memberStatus != null}"
                       th:href="@{/memberList(organization=${mbr.key.acronymOrName})}"
                       th:title="#{html.FormerPositionTo(${mbr.value.memberStatus.getLabel(locale)},${mbr.value.memberToWhen.year})}"
                       th:utext="${mbr.key.acronymOrName}"></a>
                </th:block>
            </td>
            <td>
                <th:block th:each="mbr, iMbr : ${person.futureMemberships}">
                    <th:block th:if="${!iMbr.first}">, </th:block>
                    <th:block th:if="${mbr.value.memberStatus == null}"
                              th:utext="${'ERROR:' + mbr.key.acronymOrName}"></th:block>
                    <a th:if="${mbr.value.memberStatus != null}"
                       th:href="@{/memberList(organization=${mbr.key.acronymOrName})}"
                       th:title="#{html.FuturePositionFrom(${mbr.value.memberStatus.getLabel(locale)},${mbr.value.memberSinceWhen.year})}"
                       th:utext="${mbr.key.acronymOrName}"></a>
                </th:block>
            </td>
            <td>
            	<a th:href="@{/personEditor(person=${person.id})}" th:if="${changeEnabled}">
            		<img th:src="@{/images/icon/edit_icon.svg}" th:title="#{html.EditPerson1(${person.fullName})}" style="max-width:24px;"></img>
            	</a>
           		<img th:src="@{/images/icon/edit_icon.svg}" th:unless="${changeEnabled}"
           		     th:title="#{html.EditPerson1(${person.fullName})}" style="max-width:24px;"></img>
           		<img th:id="${'btDeleteButton' + person.id}"
           		     th:src="@{/images/icon/delete_icon.svg}" th:title="#{html.DeletePerson1(${person.fullName})}"
           		     th:style="${changeEnabled} ? 'max-width:24px;cursor: pointer;' : 'max-width:24px;'"></img>
            	<a th:href="@{/exportBibTeX(author=${person.id},inAttachment=true)}">
            		<img th:src="@{/images/icon/bibtex_file.svg}" th:title="#{html.GetBibTeXPublicationsFor(${person.fullName})}" style="max-width:24px;"></img>
            	</a>
            	<a th:href="@{/exportOpenDocumentText(author=${person.id},inAttachment=true)}">
            		<img th:src="@{/images/icon/odt_file.svg}" th:title="#{html.GetOdtPublicationsFor(${person.fullName})}" style="max-width:24px;"></img>
            	</a>
            	<a th:href="@{/exportHtml(author=${person.id},inAttachment=true)}">
            		<img th:src="@{/images/icon/html_file.svg}" th:title="#{html.GetHtmlPublicationsFor(${person.fullName})}" style="max-width:24px;"></img>
            	</a>
            	<a th:href="@{/getPersonData(id=${person.id})}">
            		<img th:src="@{/images/icon/json_file.svg}" th:title="#{html.GetJsonFor(${person.fullName})}" style="max-width:24px;"></img>
            	</a>
            </td>
        </tr>
    </tbody>
</table>


<script th:inline="javascript">
    $(document).ready(function() {
        var tableId = /*[[${uuid}]]*/ '';
        var table = $('#table'+tableId).DataTable({
            dom: 'Bfrtip',
            scrollCollapse: true,
            paging: false,
            buttons: [
                'excelHtml5', 'csvHtml5'
            ],
            responsive: true,
            autoWidth: true,
            order: [ [1, 'asc'] ],
            "columns": [
            	{ },
            	{ },
            	{ },
            	{
                    "orderable": false
            	},
            	{ },
            	{ },
            	{ },
            	{ },
            	{ },
                {
                    "orderable": false,
                    "width": "165px"
                }
            ],
        });
    });

    /*[# th:if="${changeEnabled}" th:each="person : ${persons}"]*/
    installDeletionButtonCallback(
    		$("[(${'#btDeleteButton' + person.id})]"),
    		"[(#{html.DeletePerson1(${person.fullName})})]",
    		"[(#{html.AreYouSureToDelete(${person.fullName})})]",
    		"[(@{/deletePerson(person=${person.id})})]",
    		"[(#{html.PersonDeleted})]",
    		"[(#{html.CannotDeletePerson})]",
    		"[(${person.fullName})]",
    		function (e) {
    			location.reload();
    		} );
    /*[/]*/

</script>
</html>

