<!DOCTYPE html>
<html th:lang="${#locale}" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="fragments/general :: allBaseLibs"/>
<th:block th:replace="fragments/libs :: bootstrap-datatable"/>

<th:block th:replace="fragments/table :: adminTableDefinition(${changeEnabled})"/>

<table th:replace="fragments/table :: adminTable(~{::thead}, ~{::tbody})">
    <thead>
        <th th:text="#{html.Id}"></th>
        <th th:utext="#{html.LastName}"></th>
        <th th:utext="#{html.FirstName}"></th>
        <th th:utext="#{html.Gravatar}"></th>
        <th th:utext="#{html.ORCID}"></th>
        <th th:utext="#{html.Hindex}"></th>
        <th th:utext="#{html.CurrentOrganizations}"></th>
        <th th:utext="#{html.FormerOrganizations}"></th>
        <th th:utext="#{html.FutureOrganizations}"></th>
        <th th:text="#{html.Actions}"></th>
    </thead>
    <tbody>
        <tr th:each="person : ${persons}">
            <td>
                <th:block th:utext="${person.id}"></th:block>
            </td>
            <td th:with="actives = ${person.activeMemberships}">
                <s th:if="${actives.isEmpty() && !person.memberships.isEmpty()}"
                   th:utext="${person.lastName}"></s>
                <i th:if="${actives.isEmpty() && person.memberships.isEmpty()}"
                          th:utext="${person.lastName}"></i>
                <th:block th:if="${!actives.isEmpty()}"
                          th:utext="${person.lastName}"></th:block>
            </td>
            <td th:with="actives = ${person.activeMemberships}">
                <s th:if="${actives.isEmpty() && !person.memberships.isEmpty()}"
                     th:utext="${person.firstName}"></s>
                <i th:if="${actives.isEmpty() && person.memberships.isEmpty()}"
                          th:utext="${person.firstName}"></i>
                <th:block th:if="${!actives.isEmpty()}"
                          th:utext="${person.firstName}"></th:block>
            </td>
            <td>
                <img th:if="${person.gravatarId != null}"
                     th:src="${person.getGravatarURL()}"
                     th:title="${person.gravatarId}"></img>
            </td>
            <td>
                <a th:if="${person.ORCID != null}"
                   th:href="${person.orcidURL}"
                   th:utext="${person.ORCID}"></a>
            </td>
            <td>
                <th:block th:if="${person.googleScholarHindex > 0}"
                          th:utext="#{html.GoogleScholarHindex(${person.googleScholarHindex})}"></th:block>
                <th:block th:if="${person.googleScholarHindex > 0 && person.wosHindex > 0}"
                          th:utext="', '"></th:block>
                <th:block th:if="${person.wosHindex > 0}"
                          th:utext="#{html.WosHindex(${person.wosHindex})}"></th:block>
            </td>
            <td>
                <th:block th:each="mbr, iMbr : ${person.activeMemberships}">
                    <th:block th:if="${!iMbr.first}">, </th:block>
                    <th:block th:if="${mbr.value.memberStatus == null}"
                              th:utext="${'ERROR:' + mbr.key.acronymOrName}"></th:block>
                    <a th:if="${mbr.value.memberStatus != null}"
                       th:href="@{/personList(organization=${mbr.key.id})}"
                       th:title="${mbr.value.memberStatus.getLabel(locale)}"
                       th:utext="${mbr.key.acronymOrName}"></a>
					<span th:id="${'btPositionResign_' + person.id + '_' + mbr.value.id}"
					   class="fa fa-unlink"
					   th:title="#{html.PositionResign(${mbr.key.acronymOrName})}"
					   th:style="${changeEnabled} ? 'cursor: pointer;' : ''"></span>
                </th:block>
            </td>
            <td>
                <th:block th:each="mbr, iMbr : ${person.finishedMemberships}">
                    <th:block th:if="${!iMbr.first}">, </th:block>
                    <th:block th:if="${mbr.value.memberStatus == null}"
                              th:utext="${'ERROR:' + mbr.key.acronymOrName}"></th:block>
                    <a th:if="${mbr.value.memberStatus != null}"
                       th:href="@{/personList(organization=${mbr.key.id})}"
                       th:title="#{html.FormerPositionTo(${mbr.value.memberStatus.getLabel(locale)},${mbr.value.memberToWhen.year})}"
                       th:utext="${mbr.key.acronymOrName}"></a>
                </th:block>
            </td>
            <td>
                <th:block th:each="mbr, iMbr : ${person.futureMemberships}">
                    <th:block th:if="${!iMbr.first}">, </th:block>
                    <th:block th:if="${mbr.value.memberStatus == null}"
                              th:utext="${'ERROR:' + mbr.key.acronymOrName}"></th:block>
                    <a th:if="${mbr.value.memberStatus != null}"
                       th:href="@{/personList(organization=${mbr.key.id})}"
                       th:title="#{html.FuturePositionFrom(${mbr.value.memberStatus.getLabel(locale)},${mbr.value.memberSinceWhen.year})}"
                       th:utext="${mbr.key.acronymOrName}"></a>
                </th:block>
            </td>
            <td th:replace="fragments/table :: adminToolButtons(${person.id}, ${person.fullName},
            		#{html.EditPerson1(${person.fullName})},
            		#{html.DeletePerson1(${person.fullName})},
            		~{::.admin-tool-buttons},
            		author, author, author,
            		@{/getPersonData(id=${person.id})} )">
            	<a th:href="@{/membershipEditor(personId=${person.id})}"
				   th:if="${changeEnabled}"
				   class="noLink admin-tool-buttons">
            		<span class="fa fa-sitemap"
            		   th:title="#{html.EditMemberships(${person.fullName})}"
                       style="font-size:14pt"></span>
            	</a>
           		<span class="fa fa-sitemap admin-tool-buttons"
				   th:unless="${changeEnabled}"
           		   th:id="${'btEditMemberships' + person.id}"
           		   th:title="#{html.EditMemberships(${person.fullName})}"
                   style="font-size:14pt"></span>
            </td>
        </tr>
    </tbody>
</table>
<script th:inline="javascript">
    $(document).ready(() => {
    	adminTableDefinition([
        	{ },
        	{ },
        	{ },
        	{
                "orderable": false
        	},
        	{ },
        	{ },
        	{ },
        	{ },
        	{ }
        ], null, true, '170px');
        /*[# th:if="${changeEnabled}" th:each="person : ${persons}"]*/
        addDeletionButtonCallback(
        		"[(${person.id})]",
        		"[(#{html.DeletePerson1(${person.fullName})})]",
        		"[(#{html.AreYouSureToDelete(${person.fullName})})]",
        		"[(@{/deletePerson(person=${person.id})})]",
        		"[(#{html.PersonDeleted})]",
        		"[(#{html.CannotDeletePerson})]",
        		"[(${person.fullName})]",
        		function (e) {
        			location.reload();
        		} );
	    	/*[# th:each="membership : ${person.activeMemberships}"]*/
		addDeletionButtonCallbackWithButtonObj(
				$("#[(${'btPositionResign_' + person.id + '_' + membership.value.id})]"),
        		"[(#{html.DeleteMembership})]",
        		"[(#{html.AreYouSureToDeleteMembership})]",
        		"[(${membershipdeletionUrl + '?id=' + membership.value.id})]",
        		"[(#{html.MembershipDeleted})]",
        		"[(#{html.CannotDeleteMembership})]",
        		"[(${membership.key.acronymOrName})]",
        		function (e) {
        			location.reload();
        		} );
    		/*[/]*/
        /*[/]*/
    });
</script>
</html>