<!DOCTYPE html >
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="fragments/head :: style"/>
    <th:block th:replace="fragments/head :: script"/>

    <!-- jsDelivr :: Sortable :: Latest (https://www.jsdelivr.com/package/npm/sortablejs) -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>

    <style>
        .custom-select.is-valid, .form-control.is-valid, .was-validated .custom-select:valid, .was-validated .form-control:valid {
            border-color: #0d64c1;
        }
    </style>
</head>

<body>

<div class="horizontal-main-wrapper">
    <!-- main content area start -->
    <div class="main-content">
        <div class="main-content-inner">
            <div class="row" th:if="${param.publicationAdd != null}">
                <!-- seo fact area start -->
                <div class="col-lg-12">
                    <div class="card bg-success">
                        <div class="card-body">
                            <h4 class="header-title">Publication is successfully added to database.</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="main-content-inner">
            <div class="row">
                <!-- seo fact area start -->
                <div class="col-lg-12">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="header-title">Publication's authors</h4>
                            <p class="mb-3" th:utext="${'You are editing this publication: ' + publication.getPubTitle()}"></p>
                            <p class="text-muted mb-3">Add, remove and arrange authors\' order. First at top.</p>
                            <form id="form" enctype="multipart/form-data" th:action="@{/orderAuthors}" method="post" >

                                <div id="authors">
                                    <div class="form-row" th:each="author : ${publicationAuthors}" >
                                        <div class="col-md-10 mb-3">
                                            <input name="author" class="form-control list-group-item list-group-item-action list-group-item-primary" th:value="${author.getAutFirstName() + ' ' + author.getAutLastName() }" readonly="true" />
                                        </div>
                                        <div class="col-md-2 mb-3">
                                            <button class="form-control btn btn-danger mt-2 pr-2 pl-2 removeElement">Remove</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="col-md-10 mb-3">
                                        <select id="publicationAuthors"  class="form-control selectAuthor list-group-item list-group-item-action" name="publicationAuthors">
                                            <option th:each="author : ${authors}" th:utext="${author.getAutFirstName() + ' ' + author.getAutLastName() }"></option>
                                        </select>
                                    </div>
                                    <div class="col-md-2 mb-3">
                                        <button class="form-control btn btn-primary mt-2 pr-2 pl-2 addElement">Add</button>
                                    </div>
                                </div>

                                <button type="submit" class="btn btn-success mt-4 pr-4 pl-4">Submit</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- main content area end -->
</div>
<!-- page container area end -->
</body>

<script th:inline="javascript">

    function enableRemove() {
        $(document).on('click', '.removeElement', function(e) {
            e.preventDefault();
            $(this).parent().parent().remove();
        });
    }

    $(document).ready(function () {
        $('#publicationAuthors').select2({
            tags: true,
            placeholder: 'Enter author'
        });

        var el = document.getElementById("authors");
        var sortable = Sortable.create(el);

        $(document).on('click', '.addElement', function(e) {
            e.preventDefault();
            $('<div class="form-row connectedSortable test">\n' +
                ' <div class="col-md-10 mb-3">\n' +
                '    <input name="author" class="form-control list-group-item list-group-item-action list-group-item-primary" readonly="true" value="' + $('#publicationAuthors')[0].value + '"/>\n' +
                '     </div>\n' +
                '     <div class="col-md-2 mb-3">\n' +
                '    <button class="form-control btn btn-danger mt-2 pr-2 pl-2 removeElement">Remove</button>\n' +
                '     </div>\n' +
                '    </div>').appendTo('#authors');
            enableRemove();
        });

        enableRemove();

    });

</script>
</html>

